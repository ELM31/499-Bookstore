<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - The Book Cellar</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="checkout-body">
    <div class="checkout-container">
        <h1>Checkout</h1>
        
        <!-- Cart Items Section -->
        <div class="cart-section">
            <h2>Your Cart</h2>
            <div id="cartItems">
                <!-- Items will be added here by JavaScript -->
            </div>
            <div id="emptyCart" class="empty-cart">
                Your cart is empty
            </div>
        </div>

        <!-- Cart Summary -->
        <div class="cart-summary">
            <div class="summary-row">
                <span>Subtotal:</span>
                <span id="subtotal">$0.00</span>
            </div>
            <div class="summary-row">
                <span>Tax (8%):</span>
                <span id="tax">$0.00</span>
            </div>
            <div class="summary-row-total">
                <span>Total:</span>
                <span id="total">$0.00</span>
            </div>
        </div>

        <!-- Shipping Info -->
        <div class="shipping-section">
            <h2>Shipping Information</h2>
            <form id="checkoutForm">
                <label for="fullName">Full Name</label>
                <input type="text" id="fullName" name="fullName" placeholder="John Doe" required>

                <label for="email">Email</label>
                <input type="email" id="email" name="email" placeholder="john@example.com" required>

                <label for="address">Address</label>
                <input type="text" id="address" name="address" placeholder="123 Main St" required>

                <label for="city">City</label>
                <input type="text" id="city" name="city" placeholder="Los Angeles" required>

                <label for="zipcode">Zip Code</label>
                <input type="text" id="zipcode" name="zipcode" placeholder="90001" required>
            </form>
        </div>

        <!-- Payment Info -->
        <div class="payment-section">
            <h2>Payment Information</h2>
            <form id="paymentForm">
                <label for="cardName">Name on Card</label>
                <input type="text" id="cardName" name="cardName" placeholder="John Doe" required>

                <label for="cardNumber">Card Number</label>
                <input type="text" id="cardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" required>

                <div class="card-row">
                    <div class="card-field">
                        <label for="expiry">Expiry Date</label>
                        <input type="text" id="expiry" name="expiry" placeholder="MM/YY" maxlength="5" required>
                    </div>
                    <div class="card-field">
                        <label for="cvv">CVV</label>
                        <input type="text" id="cvv" name="cvv" placeholder="123" maxlength="3" required>
                    </div>
                </div>
            </form>
        </div>

        <!-- Buttons -->
        <div class="checkout-buttons">
            <button class="btn-secondary" onclick="window.location.href='/buy_page'">Continue Shopping</button>
            <button class="btn-primary" onclick="placeOrder()">Place Order</button>
        </div>
    </div>

    <script>
        // Sample cart data (in a real app, this would come from the buy_page)
        let cart = [
            { isbn: 1, name: "MySQL Training", author: "Daniel Nichter", price: 29.99, quantity: 1 },
            { isbn: 2, name: "JavaScript Training", author: "David Flanagan", price: 34.99, quantity: 2 }
        ];

        // Load cart when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Try to get cart from sessionStorage (passed from buy_page)
            const savedCart = sessionStorage.getItem('cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
            }
            renderCart();
        });

        function renderCart() {
            const cartContainer = document.getElementById('cartItems');
            const emptyCart = document.getElementById('emptyCart');
            
            if (cart.length === 0) {
                cartContainer.innerHTML = '';
                emptyCart.style.display = 'block';
                updateTotals();
                return;
            }

            emptyCart.style.display = 'none';
            cartContainer.innerHTML = cart.map((item, index) => `
                <div class="cart-item">
                    <div class="item-info">
                        <h3>${item.name}</h3>
                        <p>by ${item.author}</p>
                        <p class="item-price">$${item.price.toFixed(2)}</p>
                    </div>
                    <div class="item-controls">
                        <button onclick="updateQuantity(${index}, -1)">-</button>
                        <span class="quantity">${item.quantity}</span>
                        <button onclick="updateQuantity(${index}, 1)">+</button>
                        <button class="remove-btn" onclick="removeItem(${index})">Remove</button>
                    </div>
                </div>
            `).join('');

            updateTotals();
        }

        function updateQuantity(index, change) {
            cart[index].quantity += change;
            if (cart[index].quantity < 1) {
                cart[index].quantity = 1;
            }
            sessionStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
        }

        function removeItem(index) {
            cart.splice(index, 1);
            sessionStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
        }

        function updateTotals() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * 0.08;
            const total = subtotal + tax;

            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('total').textContent = `$${total.toFixed(2)}`;
        }

        function placeOrder() {
            // Validate forms
            const checkoutForm = document.getElementById('checkoutForm');
            const paymentForm = document.getElementById('paymentForm');

            if (!checkoutForm.checkValidity()) {
                checkoutForm.reportValidity();
                return;
            }

            if (!paymentForm.checkValidity()) {
                paymentForm.reportValidity();
                return;
            }

            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }

            // Simulate order processing
            const total = document.getElementById('total').textContent;
            
            alert(`Order placed successfully!\n\nTotal: ${total}\n\nThank you for shopping at The Book Cellar!`);
            
            // Clear cart
            cart = [];
            sessionStorage.removeItem('cart');
            renderCart();

            // Redirect to home page after delay
            setTimeout(() => {
                window.location.href = '/buy_page';
            }, 2000);
        }

        // Format card number with spaces
        document.getElementById('cardNumber').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, '').replace(/\D/g, '');
            let formatted = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formatted;
        });

        // Format expiry date
        document.getElementById('expiry').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2);
            }
            e.target.value = value;
        });
    </script>
</body>
</html>